<!DOCTYPE html>
<!--
    CheckMatin
    Copyright (C) 2026  Christophe Chatelain

    This program is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with this program.  If not, see <https://www.gnu.org/licenses/>.
-->
<html>
<head>
    <meta charset="UTF-8">
    <title>CheckMatin Dashboard</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>CheckMatin Dashboard <small id="app-version" style="font-size: 0.5em; color: #7f8c8d; font-weight: normal;"></small></h1>
            
            <!-- Main Actions -->
            <div class="actions">
                
                <!-- Left Group -->
                <div class="actions-left">
                    <button id="add-site-btn" class="accent">+ Ajouter un site</button>
                    <button id="config-manual-btn" class="secondary secondary-outline">‚öôÔ∏è T√¢ches Manuelles</button>
                    <button id="run-all-btn" class="primary">‚ñ∂Ô∏è Tout v√©rifier</button>
                </div>

                <!-- Right Group -->
                <div class="actions-right">
                    <button id="email-report" class="secondary">üìß Copier Rapport</button>
                    <button id="download-report" class="secondary">üíæ T√©l√©charger</button>
                    <button id="export-btn" class="secondary">‚¨áÔ∏è Exporter</button>
                    <button id="import-btn" class="secondary">‚¨ÜÔ∏è Importer</button>
                    <input type="file" id="import-file" accept=".json" class="input-hidden">
                    <button id="clear-results-btn" class="secondary btn-danger">üóëÔ∏è Effacer</button>
                    <input type="url" id="shared-json-url" placeholder="URL JSON r√©seau" class="shared-json-input">
                    <button id="connect-shared-json-btn" class="secondary">üîó Connexion JSON</button>
                    <span id="shared-json-status" class="alert shared-json-status">JSON inaccessible ou modifi√©</span>
                </div>
            </div>
        </header>

        <div id="site-list" class="grid-list">
            <!-- Sites will be injected here -->
        </div>
    </div>
    
    <!-- Modal for adding/editing site -->
    <div id="site-modal" class="modal hidden">
        <div class="modal-content">
            <h2>Configurer le site</h2>
            <div class="form-group">
                <label for="site-url">URL</label>
                <input type="url" id="site-url" placeholder="https://exemple.com" required>
            </div>
            <div class="form-group">
                <label for="site-name">Nom (Optionnel)</label>
                <input type="text" id="site-name" placeholder="Mon Site Perso">
            </div>
            
            <fieldset>
                <legend>Checks √† effectuer</legend>
                <div class="checkbox-group">
                    <label><input type="checkbox" id="check-status"> V√©rifier Statut (200 OK)</label>
                </div>
                <div class="checkbox-group">
                    <label><input type="checkbox" id="check-screenshot"> Capture d'√©cran</label>
                </div>
                <div class="checkbox-group">
                    <div id="content-group" class="option-group">
                        <div class="group-header">
                            <label><input type="checkbox" id="check-content"> V√©rification de contenu</label>
                            <span id="content-summary" class="group-summary"></span>
                        </div>
                        <div id="content-options" class="sub-options hidden">
                            <div class="form-group">
                                <label for="content-selector">S√©lecteur CSS</label>
                                <input type="text" id="content-selector" placeholder="ex: .welcome-message">
                            </div>
                            <div class="form-group">
                                <label for="content-text">Texte attendu</label>
                                <input type="text" id="content-text" placeholder="ex: Bienvenue">
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="checkbox-group">
                    <div id="date-group" class="option-group">
                        <div class="group-header">
                            <label><input type="checkbox" id="check-date"> V√©rification de Date/Fra√Æcheur</label>
                            <span id="date-summary" class="group-summary"></span>
                        </div>
                        <div id="date-options" class="sub-options hidden">
                            <div class="form-group">
                                <label for="date-selector">S√©lecteur CSS de la date</label>
                                <input type="text" id="date-selector" placeholder="ex: .last-updated, time">
                            </div>
                            <div class="form-group">
                                <label for="date-max-age">√Çge maximum (en minutes)</label>
                                <input type="number" id="date-max-age" placeholder="ex: 60" min="1">
                                <small class="help-text">L'extension tentera de lire la date dans le texte de l'√©l√©ment.</small>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="checkbox-group">
                    <div id="manual-group" class="option-group">
                        <div class="group-header">
                            <label><input type="checkbox" id="check-manual"> Validation Manuelle (Popup sur site)</label>
                            <span id="manual-summary" class="group-summary"></span>
                        </div>
                    </div>
                </div>
            </fieldset>

            <fieldset>
                <legend>Authentification (Optionnel)</legend>
                <div class="checkbox-group">
                    <div id="auth-group" class="option-group">
                        <div class="group-header">
                            <label><input type="checkbox" id="check-auth"> Se connecter avant les tests</label>
                            <span id="auth-summary" class="group-summary"></span>
                        </div>
                        
                        <div id="auth-options" class="sub-options hidden">
                            <div class="form-group">
                                <label for="auth-user">Utilisateur / Email</label>
                                <input type="text" id="auth-user" placeholder="mon.email@exemple.com">
                            </div>
                            <div class="form-group">
                                <label for="auth-pass">Mot de passe</label>
                                <input type="password" id="auth-pass" placeholder="********">
                                <div class="auth-info">
                                    üîí Info : Les identifiants sont chiffr√©s (AES-256) et stock√©s localement. Ils sont prot√©g√©s par votre mot de passe ma√Ætre.
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="auth-user-sel">S√©lecteur CSS Champ Utilisateur</label>
                                <input type="text" id="auth-user-sel" placeholder="ex: #username (laisser vide pour auto-d√©tection)">
                            </div>
                            <div class="form-group">
                                <label for="auth-pass-sel">S√©lecteur CSS Champ Mot de passe</label>
                                <input type="text" id="auth-pass-sel" placeholder="ex: #password (laisser vide pour auto-d√©tection)">
                            </div>
                            <div class="form-group">
                                <label for="auth-submit-sel">S√©lecteur CSS Bouton Connexion</label>
                                <input type="text" id="auth-submit-sel" placeholder="ex: button[type='submit'] (laisser vide pour auto-d√©tection)">
                            </div>
                            <div class="form-group">
                                <label><input type="checkbox" id="auth-basic"> Ce site utilise une authentification HTTP Basic (popup navigateur)</label>
                                <small class="help-text help-text-tight">Dans ce cas, les identifiants seront envoy√©s via l'URL.</small>
                            </div>
                        </div>
                    </div>
                </div>
            </fieldset>

            <div class="modal-actions">
                <button id="save-site-btn" class="primary">Enregistrer</button>
                <button id="cancel-btn" class="secondary">Annuler</button>
            </div>
        </div>
    </div>

    <!-- Modal Master Password -->
    <div id="mp-modal" class="modal hidden">
        <div class="modal-content modal-content-sm">
            <span class="close-modal" id="mp-close">&times;</span>
            <h2 id="mp-title">Mot de Passe Ma√Ætre</h2>
            <p id="mp-desc">Veuillez entrer votre mot de passe ma√Ætre.</p>
            
            <div class="form-group">
                <input type="password" id="mp-input" placeholder="Votre mot de passe ma√Ætre" class="mp-input">
                <p id="mp-error" class="mp-error">Mot de passe incorrect</p>
            </div>

            <div class="form-actions">
                <button id="mp-cancel" class="btn btn-secondary">Annuler</button>
                <button id="mp-confirm" class="btn btn-primary">Valider</button>
            </div>
        </div>
    </div>

    <!-- Modal Export Choice -->
    <div id="export-modal" class="modal hidden">
        <div class="modal-content modal-content-md">
            <span class="close-modal" id="export-close">&times;</span>
            <h2>Type d'Exportation</h2>
            <p>Choisissez le type d'exportation souhait√© :</p>
            
            <div class="export-options">
                <button id="export-full-btn" class="primary export-option">
                    <strong>üîí Sauvegarde Compl√®te (Personnelle)</strong><br>
                    <span class="export-option-desc">Inclut les mots de passe chiffr√©s et la configuration du mot de passe ma√Ætre. √Ä utiliser pour vos propres sauvegardes.</span>
                </button>
                
                <button id="export-safe-btn" class="secondary export-option">
                    <strong>üì§ Partage / Safe (Sans Mots de Passe)</strong><br>
                    <span class="export-option-desc">Exclut tous les mots de passe et donn√©es sensibles. Id√©al pour partager votre configuration avec des coll√®gues.</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Modal Report Note -->
    <div id="note-modal" class="modal hidden">
        <div class="modal-content modal-content-lg">
            <h2>Finalisation du Rapport</h2>
            
            <fieldset class="fieldset-compact">
                <legend>V√©rifications Manuelles</legend>
                <div id="manual-checks-list" class="checkbox-group manual-checks-list">
                    <!-- Checkboxes injected by JS -->
                    <p class="empty-text">Aucune t√¢che configur√©e.</p>
                </div>
            </fieldset>

            <p>Note g√©n√©rale (Optionnel) :</p>
            <div class="form-group">
                <textarea id="report-note-input" rows="3" placeholder="Ex: RAS ce matin, tout est op√©rationnel." class="note-textarea"></textarea>
            </div>

            <div class="modal-actions">
                <button id="save-note-btn" class="primary">Valider & Voir R√©sultats</button>
                <button id="skip-note-btn" class="secondary">Passer</button>
            </div>
        </div>
    </div>

    <!-- Modal Config Manual Checks -->
    <div id="manual-config-modal" class="modal hidden">
        <div class="modal-content modal-content-lg">
            <span class="close-modal" id="manual-config-close">&times;</span>
            <h2>Configuration des T√¢ches Manuelles</h2>
            <p>Ajoutez ici les t√¢ches que vous devez v√©rifier physiquement (T√©l√©phone, Applications lourdes, etc.).</p>
            
            <div class="manual-add-row">
                <input type="text" id="new-manual-task" placeholder="Nouvelle t√¢che (ex: Tester Ligne Fixe)" class="manual-task-input">
                <button id="add-manual-task-btn" class="primary">Ajouter</button>
            </div>

            <ul id="manual-tasks-list" class="manual-tasks-list">
                <!-- List items injected by JS -->
            </ul>

            <div class="modal-actions">
                <button id="save-manual-config-btn" class="primary">Enregistrer</button>
            </div>
        </div>
    </div>

    <script src="options.js"></script>
</body>
</html>
